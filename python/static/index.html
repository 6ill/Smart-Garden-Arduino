<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type= "text/css" href= "./static/style.css" />
    <title>Arduino Interface</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <main>
      <h1>Smart Garden Dashboard</h1>
      <div class="dashboard">
        <div class="temperature-container">
          Temperature:
          <span id="thermometer">
            <span id="temperature-indicator"></span>
          </span>
          <h2 id="temperature-value">_</h2>
        </div>
        <div class="group-1">
          <div class="group-2">
            <div class="light-container">
              Light:
              <h2 id="light-value">_</h2>
            </div>
            <div class="humidity-container">
              Humidity:
              <h2 id="humidity-value">_</h2>
              <span id="humidity-indicator"></span>
            </div>
            <div class="soil-container">
              Soil Moisture:
              <h2 id="soil-value">_</h2>
              <span id="soil-indicator"></span>
            </div>
          </div>
          <div class="manual-control-container">
            <form action="/control" id="water-form" method="post">
              <p>Activate watering system (s):</p>
              <div>
                <input type="number" min="1" max="99" name="second" id="input-second" required/>
                <input class="submit" type="submit" value="Water" id="submit-water"/>
              </div>
            </form>
            <div class="mice-container">
              <div>
                <p>Mice Detector Status:</p>
                <span id="mice-indicator"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <div class="blur-circle"></div>

    
    <script>
      // document.getElementById("submit-water").addEventListener("click", () => {
      //   const inputValue = parseInt(document.getElementById("input-water").value, 10);
      //   if (!isNaN(inputValue)) {
      //     setTimeout(() => {
      //       document.getElementById("submit-water").disabled = true;
      //       document.getElementById("input-second").disabled = true;
      //     }, inputValue * 1000 + 3000);
      //   } else {
      //     console.error("Invalid input value for delay");
      //   }
      // })
      // $('#water-form').on('submit', function(e){
      //   console.log(Number($("#input-second").val()));
      //   setTimeout(() => {
      //     $("#submit-water").prop('disabled',false);
      //     $("#input-second").prop('disabled',false);
      //   }, Number($("#input-second").val()) * 1000 + 3000)
      // });   
      
      $(document).ready(function () {
        function updateData() {
          $.get("/data", function (data) {
            $("#humidity-value").text(data.humidity);
            $("#humidity-indicator").height(`${data.humidity}%`);
  
            $("#temperature-value").text(data.temperature + " C");
            $("#temperature-indicator").css("bottom", `${data.temperature}%`);
  
            $("#soil-value").text(data.moist_pct + "%");
            $("#soil-indicator").height(`${data.moist_pct}%`);
  
            $("#light-value").text(data.light);
          });

          $.get("/mouse", (data) => {  
            $('#mice-indicator').text(data.status);
            if (data.status == '1') {
                $(".mice-container").css("backgroundColor", "rgb(120, 0, 0)")
              } else {
                $(".mice-container").css("backgroundColor", "rgb(46, 46, 46, 0.4)")
              }
          })
        }
        

        setInterval(updateData, 100); // Update 100 milisecond
      });
    </script>
  </body>
</html>
